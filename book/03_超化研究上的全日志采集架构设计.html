<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>超化研究上的全日志采集架构设计 | 超级个体:多Agent协作与自动化产品实践</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.png">
    <link rel="stylesheet" href="/font-awesome-5.11.2/css/all.min.css">
    <meta name="description" content="能够灵活满足企业数字化建设中各种场景的需要，更高效、专注的沉淀业务和数据能力，进而形成企业的业务和数据中台。通过能力的灵活组合，快速的应对当前快节奏的市场需求，助力企业数字化转型的成功。">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.36eaa0e9.css" as="style"><link rel="preload" href="/assets/js/app.81a3b29d.js" as="script"><link rel="preload" href="/assets/js/2.a0f79140.js" as="script"><link rel="preload" href="/assets/js/1.694abfa3.js" as="script"><link rel="preload" href="/assets/js/26.9a6a81ea.js" as="script"><link rel="prefetch" href="/assets/js/10.7b3cf886.js"><link rel="prefetch" href="/assets/js/11.78cc4786.js"><link rel="prefetch" href="/assets/js/12.d92132d8.js"><link rel="prefetch" href="/assets/js/13.20d0a939.js"><link rel="prefetch" href="/assets/js/14.a772a9f7.js"><link rel="prefetch" href="/assets/js/15.7107cfb5.js"><link rel="prefetch" href="/assets/js/16.a597e62d.js"><link rel="prefetch" href="/assets/js/17.ebc17f9d.js"><link rel="prefetch" href="/assets/js/18.4da2b376.js"><link rel="prefetch" href="/assets/js/19.f1783c52.js"><link rel="prefetch" href="/assets/js/20.b5d97bea.js"><link rel="prefetch" href="/assets/js/21.2094403b.js"><link rel="prefetch" href="/assets/js/22.58fa4180.js"><link rel="prefetch" href="/assets/js/23.c083ba07.js"><link rel="prefetch" href="/assets/js/24.871a198f.js"><link rel="prefetch" href="/assets/js/25.72073228.js"><link rel="prefetch" href="/assets/js/27.eca0e8a8.js"><link rel="prefetch" href="/assets/js/28.a2214cdc.js"><link rel="prefetch" href="/assets/js/29.20ed5b22.js"><link rel="prefetch" href="/assets/js/3.03c32384.js"><link rel="prefetch" href="/assets/js/30.3c107982.js"><link rel="prefetch" href="/assets/js/31.50028132.js"><link rel="prefetch" href="/assets/js/32.27c29790.js"><link rel="prefetch" href="/assets/js/33.e384930b.js"><link rel="prefetch" href="/assets/js/34.bde6b024.js"><link rel="prefetch" href="/assets/js/35.0879c1db.js"><link rel="prefetch" href="/assets/js/36.3611d9d6.js"><link rel="prefetch" href="/assets/js/37.8347bdd2.js"><link rel="prefetch" href="/assets/js/38.05b5ea97.js"><link rel="prefetch" href="/assets/js/39.4393507a.js"><link rel="prefetch" href="/assets/js/4.d73928a3.js"><link rel="prefetch" href="/assets/js/40.a301fc11.js"><link rel="prefetch" href="/assets/js/41.2136f069.js"><link rel="prefetch" href="/assets/js/42.36f0cd6b.js"><link rel="prefetch" href="/assets/js/43.ef84fe7a.js"><link rel="prefetch" href="/assets/js/44.7c1a48aa.js"><link rel="prefetch" href="/assets/js/45.1cc0d26d.js"><link rel="prefetch" href="/assets/js/46.64757953.js"><link rel="prefetch" href="/assets/js/5.96f6f0cd.js"><link rel="prefetch" href="/assets/js/6.e9960a4b.js"><link rel="prefetch" href="/assets/js/7.3cadad3f.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5cff1987.js">
    <link rel="stylesheet" href="/assets/css/0.styles.36eaa0e9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="超级个体:多Agent协作与自动化产品实践" class="logo"> <span class="site-name can-hide">超级个体:多Agent协作与自动化产品实践</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  封面
</a></div><div class="nav-item"><a href="/book/" class="nav-link router-link-active">
  书籍目录
</a></div><div class="nav-item"><a href="http://portal.infra.linesno.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  产品设计
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/alinesno-infrastructure/alinesno-infra-book-press" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  封面
</a></div><div class="nav-item"><a href="/book/" class="nav-link router-link-active">
  书籍目录
</a></div><div class="nav-item"><a href="http://portal.infra.linesno.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  产品设计
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/alinesno-infrastructure/alinesno-infra-book-press" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>行业发展需求</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>产品架构设计</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/book/03_超化研究上的全日志采集架构设计.html" class="active sidebar-link">超化研究上的全日志采集架构设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/book/03_超化研究上的全日志采集架构设计.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/book/03_超化研究上的全日志采集架构设计.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/book/03_超化研究上的全日志采集架构设计.html#过程设计" class="sidebar-link">过程设计</a></li><li class="sidebar-sub-header"><a href="/book/03_超化研究上的全日志采集架构设计.html#采集工具" class="sidebar-link">采集工具</a></li><li class="sidebar-sub-header"><a href="/book/03_超化研究上的全日志采集架构设计.html#维护平台" class="sidebar-link">维护平台</a></li><li class="sidebar-sub-header"><a href="/book/03_超化研究上的全日志采集架构设计.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/book/03_超化研究上的全日志采集架构设计.html#鸣谢" class="sidebar-link">鸣谢</a></li></ul></li><li><a href="/book/04_使用AIGC提升平台能力架构设计经验.html" class="sidebar-link">使用AIGC提升平台能力架构设计经验</a></li><li><a href="/book/05_平台与AIGC交互的组件设计方案.html" class="sidebar-link">平台与AIGC交互的组件设计方案</a></li><li><a href="/book/06_平台与AIGC交互的多Agent交互方案.html" class="sidebar-link">平台与AIGC交互的多Agent交互方案</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LLM交互设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Agent角色实践</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>产品研发总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>致谢</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="超化研究上的全日志采集架构设计"><a href="#超化研究上的全日志采集架构设计" class="header-anchor">#</a> 超化研究上的全日志采集架构设计</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <blockquote><p>以下是针对超化管理超化的设计，因此会偏向技术方向的阐述。</p></blockquote> <p>目前对于超化的关注点似乎更多集中在方法论方面，而较少关注具体实现，目前仍处于探索阶段。我们的编码工作目前在Github上进行，以便与对这个领域感兴趣的同学进行更好的交流。</p> <p>在进行超自动化研究的过程中，我们遇到了数据采集的问题。在上层自动化过程中，需要大量的数据支持，因此需要采集大量内容。由于缺乏业务场景，我们在这方面的研究考虑是先使用超自动化来管理超自动化（即自己管理自己）。这里主要针对日志采集设计。</p> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>我们原来的整体设计方向是朝着数据支持方面发展的。根据一定的规则和判断条件，结合AGI（人工通用智能）的推理判断，形成智能化的操作。在日志的采集和管理方面，我们需要采集完整的数据链，进行判断、管理和预测。在确定采集哪些数据时，我们参考了许多开源项目，但也发现了一些问题。各个开源项目过于分散，无法形成组合，数据分离也比较麻烦。另外，技术迭代速度较快，有些项目没有很好地跟进。综合考虑后，我们需要进行部分重写和整合。这里主要采集的内容包括：</p> <ul><li>前端日志：包括UI事件、访问日志、操作日志、热点日志和IO日志等。</li> <li>自动化日志：镜像日志、构建日志、过程日志和操作日志。</li> <li>安全日志：代码、质量、版本、漏洞安全、容器漏洞、密钥日志和Git提交日志等。</li> <li>应用日志：运行日志、运行状态、请求日志、运行情况和链路情况等。</li> <li>系统日志：操作日志、历史日志、IO日志、网络日志、请求情况和运行情况等。</li> <li>操作日志：操作记录、SQL操作和审计操作等。</li> <li>登录日志：登录的所有信息和请求，例如IP、地点、位置和账号等。</li> <li>项目日志：任务操作日志、变更日志、审计日志、人员变动和状态变更等。</li> <li>链路追踪：请求链路、操作链路、日志链路、SQL链路和阶段链路等。</li> <li>...</li></ul> <p>这只是初步设计，后期还会增加。目前按照上述设计进行集成，采集回来的数据使用流水线方式进行判断和处理。在这个过程中，我们主要使用了GPT的推理结果作为推理能力的基础。当前的原则是尽量使用流水线和自动化，在特定阶段使用GPT的能力作为辅助，以提高过程的稳定性。实现的超化能力演化效果类似于以下示例：</p> <ul><li>在云服务器准备到期时，自动采购或续费。</li> <li>当功能准备延期时，自动通知并向指定人员提供合理建议的方案。</li> <li>每月或每周自动生成报告结果，并给出合理的建议。</li> <li>自动检测和构建验证过程中的漏洞，并生成分支。</li> <li>...</li></ul> <p>在这些过程中，我们使用规则和推理能力进行简单的判断，协调这些自动化流水线，类似于自动驾驶，但也有辅助驾驶，推理能力就是这个协调的大脑。为了实现更便捷的操作，我们还添加了语音交互，以便更好地进行操作，并将结果通过SSE推送到系统界面或进行语音播报。</p> <p>下面是当前设计的整合思路，这仅涉及日志采集方面的设计，其他自动化内容不包含在其中，我有自己的思路。</p> <h2 id="过程设计"><a href="#过程设计" class="header-anchor">#</a> 过程设计</h2> <p>相对而言，采集的设计是相对简单的。目前有许多开源工具可用，但搭建起来可能需要较长时间。然而，由于AIGC（人工智能生成代码）的能力，我们可以使用生成式代码和单元测试，效果还是不错的。</p> <h2 id="采集工具"><a href="#采集工具" class="header-anchor">#</a> 采集工具</h2> <p>我们的采集工具主要使用了一些开源工具，并结合了Maven、Shell和自研的流水线进行改进。在选择工具时，我们考虑了定制化的需求，并综合考虑后决定自行开发。下面是我们主要使用的采集技术：</p> <ul><li>前端采集：log.js、filebeat和nginx。</li> <li>自动化采集：Python + shell，并将数据发送到Webhook。</li> <li>安全日志采集：Trivy、Checkstyle、Murphysec、SpotBugs、Gitleaks等工具。</li> <li>应用日志采集：自定义的logback、OpenTelemetry、AOP、Nginx等。</li> <li>系统日志采集：Ansible、Shell、Python，定时采集结果并结合node-exporter返回。</li> <li>操作日志采集：AOP和自定义的logback，自定义的MC参数。</li> <li>登录日志采集：Nginx、AOP等。</li> <li>项目日志采集：通过调用API进行定时采集，并有一些会接收推送结果（例如禅道）。</li> <li>链路追踪采集：OpenTelemetry和agent的方式。</li></ul> <p>对于数据量较大的情况，我们使用Kafka作为数据缓冲。为了方便交互和安全性，我们在Kafka前面加了一层控制器层，提供了HTTP接口，并使用自定义的令牌进行拦截。目前还在研究过程中，尚未添加HTTPS。</p> <p>有些Webhook提供的是一个前端系统，例如Spring Boot应用或gRPC应用，它们接收数据后将其输入到数据仓库中。我们使用ClickHouse作为数据仓库，因为它能够保存多种数据结构。一些日志会在实时计算后保存到数据仓库中，另一部分会使用数据进行离线计算。我们对ds的2.0版本进行了二次开发，以适应当前的工程结构并更好地维护。</p> <h2 id="维护平台"><a href="#维护平台" class="header-anchor">#</a> 维护平台</h2> <p>采集之后，并不仅仅是结束了。我们还设计了几个平台来管理数据，以应对不同的应用场景。这些平台类似于数据的前端和展示，便于管理过程流程跟进，并提供更好的可视化。我们基于Ruoyi-Plus进行了改造，主要产出了以下平台，便于维护管理，比如自动操作服务、安全感知服务、持续集成服务、日志审计服务、容器管理服务、监控预警服务、链路追踪服务等。</p> <p>这些服务功能主要是在数据上展示和管理，便于超自动化的管理。一些数据来源于ODS层和ADS层，目前的流水线集成还在GitHub Actions上，但数据应该已经采集到了。后续需要进行验证，并进行多个自动化流水线的验证处理。这个过程可能需要进行调试，当前的功能点已经规划和编码产出。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>以上是我们在研究超自动化过程中关于日志处理的思路和结构。目前还在进行调试和验证。除了日志的自动化处理，还有其他方面需要结合超自动化，例如项目管理、产品市场营销、流水线自动生成等。希望对从事这方面的同学提供一些经验参考。</p> <h2 id="鸣谢"><a href="#鸣谢" class="header-anchor">#</a> 鸣谢</h2> <p>在处理日志的过程中，我们参考了一些产品，主要包括以下内容：</p> <ul><li>GitHub Security服务</li> <li>阿里云分布式链路</li> <li>AnsibleTower自动化操作</li> <li>ELK套件</li> <li>PlumeLog开源日志工具</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/alinesno-infrastructure/alinesno-infra-book-press/edit/main/docs/book/03_超化研究上的全日志采集架构设计.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/1/2024, 1:16:00 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/book/10_智能体产品整体设计方案.html" class="prev">
        智能体产品整体设计方案
      </a></span> <span class="next"><a href="/book/04_使用AIGC提升平台能力架构设计经验.html">
        使用AIGC提升平台能力架构设计经验
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.81a3b29d.js" defer></script><script src="/assets/js/2.a0f79140.js" defer></script><script src="/assets/js/1.694abfa3.js" defer></script><script src="/assets/js/26.9a6a81ea.js" defer></script>
  </body>
</html>
